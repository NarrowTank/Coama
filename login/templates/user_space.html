<!DOCTYPE html>
{% load static %}
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="{% static 'css/user_style.css' %}">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">    
    <link rel="shortcut icon" href='{% static "src/icon_fav.png" %}' type="image/x-icon">
    <title>III COAMA - CONGRESSO AMAZÔNICO DE MINERAÇÃO, METALURGIA E MATERIAIS</title>
    <script src="https://sdk.mercadopago.com/js/v2"></script>
</head>

<body>
    <!--inicio menu login-->
    <div class="background-menu-login">
        <div class="container">
            <nav class="menu-login">
                <div class="menu-login-esquerda">
                    <a href="mailto:coama.event@gmail.com" target="_blank">
                        <img src='{% static "src/envelope.png" %}' alt="Icone e-mail" class="icon">
                        <span>coama.event@gmail.com</span>
                    </a>
                    <a href="https://api.whatsapp.com/send?phone=5594984449527" target="_blank">
                        <img src='{% static "src/whatsapp.png" %}' alt="Icone Whatsapp" class="icon">
                        <span>(94)98444-9527</span>
                    </a>
                </div>
                <div class="redes">
                    <a href="https://www.linkedin.com/in/congresso-amazonico-de-mineracao-metalurgia-e-materiais/?originalSubdomain=br"
                        target="_blank"><img src='{% static "src/linkedin.png" %}' alt="Icone Linkedin"
                            class="icon"></a>
                    <a href="https://www.tiktok.com/@evento.coama?_t=8lr5zr2LhiP&_r=1" target="_blank"><img
                            src='{% static "src/tiktok.png" %}' alt="Icone Tiktok" class="icon"></a>
                    <a href="https://www.instagram.com/eventocoama/" target="_blank"><img
                            src='{% static "src/instagram.png" %}' alt="Icone Instagram" class="icon"></a>

                <!-- Botão de logout com ícone -->
                {% if user.is_authenticated %}
                    <form method="post" action="{% url 'logout' %}" style="display: inline;">
                        {% csrf_token %}
                            <button type="submit" class="logout-button" style="height: 20px; width: 30px; margin-left: 30px;">
                            <i class=""></i> Sair
                            </button> 
                        </form>
                            {% endif %}
                    </div>
                </div>
            </nav>
        </div>
    </div>
    <!--fim menu login-->

<!-- 
{% if payed == 'False' %}
    <div class="payment-box">
        <h2 style="font-size: 15px">Faça apenas o pagamento da inscrição</h2>
        <div id="wallet_container"></div>

        <div class="selection-courses-box">
            <h2 style="font-size: 15px">Ou faça o pagamento da inscrição com os minicursos e receba 10% de desconto</h2>
            <button id="selection-courses">Selecione os minicursos</button>
        </div>
    </div>
{% endif %}
-->


    <!--início menu principal-->
    <div id="main-heather" class="menu-principal-container" style="margin-bottom: 20px">
        <div class="container">
            <nav class="menu-principal">
                <div class="titulo">
                    <h1>Página do Participante</h1>
                </div>
            </nav>
        </div>
    </div>

    <div id="main-heather" class="menu-principal-container-mobile">
        <div class="container">
            <nav class="menu-principal-mobile">
                <div class="titulo">
                    <ul>
                        <input type='checkbox' id='check' />
                        <span class="menu">
                            <li class="nav-item" data-target="dados-pessoais">Dados Pessoais</li>
                            <li class="nav-item" data-target="mini-cursos">Minicursos</li> 
                            <li class="nav-item" data-target="combo">Combo</li> 
                            <li class="nav-item" data-target="submissao-trabalho">Submissão de Trabalho</li> 
                            <label for="check" class="close-menu"><i class="fas fa-times"></i></label>
                        </span>
                        <label for="check" class="open-menu"><i class="fas fa-bars"></i></label>
                    </ul>
                    <h1>Página do Participante</h1>
                </div>
            </nav>
        </div>
    </div>
    
    <main>
        
        <div class="container-main">
            <div class="content first-content">
                <div class="first-column">
                    <h2 class="title title-primary">Bem-Vindo!</h2>
                    <ul class="first-column-ul">
                        <li class="nav-item" data-target="dados-pessoais"><i class="fas fa-user icon"></i>Dados Pessoais</li>
                        <li class="nav-item" data-target="mini-cursos"><i class="fas fa-book icon"></i>Minicursos</li>
                        <li class="nav-item" data-target="combo"><i class="fas fa-users icon"></i>Combo</li>
                        <li class="nav-item" data-target="submissao-trabalho"><i class="fas fa-file-alt icon"></i>Submissão de Trabalho</li>
                    </ul> 
                </div>    
                <div class="second-column">
                    <div class="dados-pessoais">
                        
                        <div class="box">
                            <h2>Nome Crachá:</h2>
                            <p>{{nomecracha}}</p>
                        </div>

                        <div class="box">
                            <h2>CPF:</h2>
                            <p>{{cpf}}</p>
                        </div>
                           
                        <div class="box">
                            <h2>E-mail:</h2>
                            <p>{{email}}</p>
                        </div>

                        <div class="box">
                            <h2>Telefone:</h2>
                            <p>{{telefone}}</p>
                        </div>

                        <div class="box">
                            <h2>Cidade:</h2>
                            <p>{{cidade}}</p>
                        </div>

                        <div class="box">
                            <h2>Estado:</h2>
                            <p>{{estado}}</p>
                        </div>
                        
                        {% if user_type == 1 %}
                        <div class="box">
                            <h2>Curso:</h2>
                            <p>{{curso}}</p>
                        </div>

                        <div class="box">
                            <h2>Instituição:</h2>
                            <p>{{instituicao}}</p>
                        </div>

                        <div class="box">
                            <h2>Matrícula:</h2>
                            <p>{{matricula}}</p>
                        </div>
                        {% endif %}

                        {% if user_type == 2 %}
                        <div class="box">
                            <h2>Área de atuação:</h2>
                            <p>{{area}}</p>
                        </div>

                        <div class="box">
                            <h2>Instituição:</h2>
                            <p>{{instituicao}}</p>
                        </div>
                        {% endif %}

                        {% if user_type == 3 %}
                        <div class="box">
                            <h2>Empresa:</h2>
                            <p>{{empresa}}</p>
                        </div>
                        {% endif %}                    
                    </div>
                    <div class="mini-cursos" style="display: none;">
                        <form action="{% url 'subscription' %}" method="POST" style="width: 100%;display: inherit;flex-direction: inherit;">
                            {% csrf_token %}
                            
                      
                    
        
                        </form>
                        <script>
                                document.getElementById('submitCombo').addEventListener('click', function(event) {
                                event.preventDefault();
                                if (validateForm()) {
                                    let selectedCourses = [];
                                    const checkboxes = document.querySelectorAll('.mini-cursos input[type="checkbox"]:checked');

                                    checkboxes.forEach((checkbox) => {
                                        selectedCourses.push(checkbox.name);
                                    });

                                    localStorage.setItem('selectedCourses', JSON.stringify(selectedCourses));
                                    console.log(localStorage.getItem('selectedCourses'));

                                    document.querySelector('.nav-item[data-target="combo"]').click();
                                } else {
                                    console.log('O formulário não é válido.');
                                }
                            });
                        </script>
                    </div>
                    
                    <div class="submissao-trabalho" style="display: none;">
                        <p>Para baixar os arquivos com exemplos de como devem ser formatados os trabalhos, clique nos botões abaixo:</p>
                        <a href="https://download1500.mediafire.com/ixfk96yxyiag5y55sxq6Wig_32vKO7VmxYLpbseJzIxFNjFjfmGV89Jf7y0gb5pEun6VCIvDMl5FjMDIYFjOm9SBSzaPWFIateQXdrQGABscEaaBPT7rw6hHGqXrJfY5zDr6W6IiL_l5QrZo1MdrrzLNtsHB7wqjDMeyzKqiGuWEg-M/fp6zgbsntbe3ynr/Modelo+de+Apresenta%C3%A7%C3%A3o+%28Palestras%29.pptx" download class="button">
                            <i class="fas fa-download"></i> Baixar Modelo de Apresentação
                        </a>
                        <a href="https://download1523.mediafire.com/gn6p1x26jjbgya5VWUvTLPD3Jn5plB4DLv9pFhaf13TIG8YsmjkSHBURJ2Hkalz6r6rQCBFRKe6EBnwnYBnVRxsfWyM20AmyXo2PkNPPyJoB3uezfOGMsNOF0pqOcYvJxr9CdumnYeJnQdecsEFGswxk42R5e2QH3506gzDYXYYPYdI/ni6lv4feuh068tk/Modelo+de+Banner+III+COAMA.pptx" download class="button">
                            <i class="fas fa-download"></i> Baixar Modelo de Banner
                        </a>
                        <a href="https://download854.mediafire.com/j4j9ysx9udegHXMO-UPQOCGDKzRX57bg3eI1gZ9vGmCPrUwp526Wn6HxYsLcmgBHG7cD1c7YaFoWnKRFzSP7BtI6qx_qO5oOr9bjPAprIlE9IGqY0ACclDiniGe_FMNI32p7HsNOZgiQrNvfHnqZdaDLI3-pxVxx80rvXgojJtXgnl8/o88kny95cara0lh/Modelo_de_artigo_Coama.docx" download class="button">
                            <i class="fas fa-download"></i> Baixar Modelo de Artigo
                        </a>
                        <form action="{% url 'send-work' %}" method="POST" enctype="multipart/form-data">
                            {% csrf_token %}
                            <p>Selecione o arquivo que deseja enviar para avaliação:</p>
                            <label class="label-input" for="comprovante-vinculo">
                                <i class="fas fa-file-alt icon-modify"></i>
                                {{ form.file }}
                            </label>
                            
                            <input type="submit" value="Enviar" id="submitBtn" class="button">
                        </form>
                    </div>
                    <div class="combo" style="display: none;">
                        <form id="cpf-form" action="{% url 'check-cpf' %}" method="post" class="combo-form">
                            {% csrf_token %}
                            
                            <div class="box">
                                <label for="nome1">Nome 1:</label>
                                <input type="text" id="nome1" name="nome1" required>
                                <br><br>
                                <label for="cpf1">CPF 1:</label>
                                <input type="text" id="cpf1" name="cpf1" oninput="formatCPF(this)" required>
                            </div>
                    
                            <div class="box">
                                <label for="nome2">Nome 2:</label>
                                <input type="text" id="nome2" name="nome2" required>
                                <br><br>
                                <label for="cpf2">CPF 2:</label>
                                <input type="text" id="cpf2" name="cpf2" oninput="formatCPF(this)" required>
                            </div>
                    
                            <div class="box">
                                <label for="nome3">Nome 3:</label>
                                <input type="text" id="nome3" name="nome3" required>
                                <br><br>
                                <label for="cpf3">CPF 3:</label>
                                <input type="text" id="cpf3" name="cpf3" oninput="formatCPF(this)" required>
                            </div>
                    
                            <div class="box">
                                <label for="nome4">Nome 4:</label>
                                <input type="text" id="nome4" name="nome4" required>
                                <br><br>
                                <label for="cpf4">CPF 4:</label>
                                <input type="text" id="cpf4" name="cpf4" oninput="formatCPF(this)" required>
                            </div>
                            
                            <input type="hidden" id="comboValue" name="combo" value="false">
                    
                            <div class="selection-courses-box">
                                <button 
                                    id="confirm-selection" 
                                    type="button" 
                                    style="background-color: #FEB609; border: 1px solid #FEB609; transition: background-color .5s; cursor: pointer; border-radius: 15px; text-transform: uppercase; color: black; font-size: 10px; padding: 10px 50px; font-weight: bold; width: 250px; margin: 1rem;"
                                    onclick="return validateForm();"
                                >
                                Realizar pagamento
                                </button>
                            </div>
                        </form>
                    </div>
                    
                    <script>
                        function formatCPF(input) {
                            let value = input.value.replace(/\D/g, ''); // Remove caracteres não numéricos
                            if (value.length <= 11) {
                                value = value.replace(/(\d{3})(\d)/, "$1.$2");
                                value = value.replace(/(\d{3})(\d)/, "$1.$2");
                                value = value.replace(/(\d{3})(\d{1,2})$/, "$1-$2");
                            }
                            input.value = value;
                        }
                    </script>
                    
                    
                    <script>
                        document.getElementById('confirm-selection').addEventListener('click', function() {
                            const form = document.getElementById('cpf-form');
                            if (!form) {
                                console.error('Formulário não encontrado');
                                return;
                            }
                            const inputs = form.querySelectorAll('input');
                            let isValid = true;
                            let emptyFields = [];

                            inputs.forEach(input => {
                                if (input.value.trim() === '') {
                                    isValid = false;
                                    emptyFields.push(input.previousElementSibling.textContent.trim());
                                }
                            });

                            if (!isValid) {
                                alert('Por favor, preencha todos os campos obrigatórios: ');
                                return;
                            }
                            const formData = new FormData(form);
                    
                            formData.append('csrfmiddlewaretoken', document.querySelector('input[name="csrfmiddlewaretoken"]').value);
                    
                            const selectedCourses = localStorage.getItem('selectedCourses');
                            if (selectedCourses) {
                                const coursesArray = JSON.parse(selectedCourses);
                                coursesArray.forEach(course => {
                                    formData.append(course, 'on');
                                });
                            } else {
                                console.error('Nenhum curso selecionado.');
                                return;
                            }
                    
                            fetch(form.action, {
                                method: 'POST',
                                body: formData
                            })
                            .then(response => {
                                return response.json();
                            })
                            .then(data => {
                    
                                if (data.success === true) {
                                    localStorage.setItem('verifiedEmails', JSON.stringify(data.emails));
                                    registerCourses();
                                } else {
                                    alert('Um ou mais CPFs não estão cadastrados no sistema:', data.error || 'Erro desconhecido');
                                    console.error('Um dos CPFs não estão cadastrados no sistema', data.error || 'Erro desconhecido');
                                }
                            })
                            .catch(error => {
                                console.error('Erro na solicitação AJAX:', error);
                            });
                        });
                    
                        function registerCourses() {
                            console.log('Iniciando registro de cursos');
                            const subscriptionForm = document.createElement('form');
                            subscriptionForm.method = 'POST';
                            subscriptionForm.action = '{% url "subscriptions_combo" %}';
                    
                            const csrfToken = document.createElement('input');
                            csrfToken.type = 'hidden';
                            csrfToken.name = 'csrfmiddlewaretoken';
                            csrfToken.value = document.querySelector('input[name="csrfmiddlewaretoken"]').value;
                            subscriptionForm.appendChild(csrfToken);
                    
                            const selectedCourses = localStorage.getItem('selectedCourses');
                            if (selectedCourses) {
                                const coursesArray = JSON.parse(selectedCourses);
                                coursesArray.forEach(course => {
                                    const courseInput = document.createElement('input');
                                    courseInput.type = 'hidden';
                                    courseInput.name = course;
                                    courseInput.value = 'on';
                                    subscriptionForm.appendChild(courseInput);
                                });
                            } else {
                                console.error('Nenhum curso selecionado.');
                                return;
                            }
                    
                            document.body.appendChild(subscriptionForm);
                            subscriptionForm.submit();
                        }
                    </script>                                
                </div>
            </div>
        </div>
        <div class="container-main-mobile">  
                <div class="second-column">
                    <div class="dados-pessoais">
                        
                        <div class="box">
                            <h2>Nome Crachá:</h2>
                            <p>{{nomecracha}}</p>
                        </div>

                        <div class="box">
                            <h2>CPF:</h2>
                            <p>{{cpf}}</p>
                        </div>
                           
                        <div class="box">
                            <h2>E-mail:</h2>
                            <p>{{email}}</p>
                        </div>

                        <div class="box">
                            <h2>Telefone:</h2>
                            <p>{{telefone}}</p>
                        </div>

                        <div class="box">
                            <h2>Cidade:</h2>
                            <p>{{cidade}}</p>
                        </div>

                        <div class="box">
                            <h2>Estado:</h2>
                            <p>{{estado}}</p>
                        </div>

                        {% if user_type == 1 %}
                        <div class="box">
                            <h2>Curso:</h2>
                            <p>{{curso}}</p>
                        </div>

                        <div class="box">
                            <h2>Instituição:</h2>
                            <p>{{instituicao}}</p>
                        </div>

                        <div class="box">
                            <h2>Matrícula:</h2>
                            <p>{{matricula}}</p>
                        </div>
                        {% endif %}

                        {% if user_type == 2 %}
                        <div class="box">
                            <h2>Área de atuação:</h2>
                            <p>{{area}}</p>
                        </div>

                        <div class="box">
                            <h2>Instituição:</h2>
                            <p>{{instituicao}}</p>
                        </div>
                        {% endif %}

                        {% if user_type == 3 %}
                        <div class="box">
                            <h2>Empresa:</h2>
                            <p>{{empresa}}</p>
                        </div>
                        {% endif %}
                    </div>
                    <div class="mini-cursos" style="display: none;">
                        <form action="{% url 'subscription' %}" method="POST" style="width: 100%;display: inherit;flex-direction: inherit;">
                            {% csrf_token %}
                           
                            
                    </form>
                    </div>
                    <div class="submissao-trabalho" style="display: none;">
                        <p>Para baixar os arquivos com exemplos de como devem ser formatados os trabalhos, clique nos botões abaixo:</p>
                        <a href="https://download1500.mediafire.com/ixfk96yxyiag5y55sxq6Wig_32vKO7VmxYLpbseJzIxFNjFjfmGV89Jf7y0gb5pEun6VCIvDMl5FjMDIYFjOm9SBSzaPWFIateQXdrQGABscEaaBPT7rw6hHGqXrJfY5zDr6W6IiL_l5QrZo1MdrrzLNtsHB7wqjDMeyzKqiGuWEg-M/fp6zgbsntbe3ynr/Modelo+de+Apresenta%C3%A7%C3%A3o+%28Palestras%29.pptx" download class="button">
                            <i class="fas fa-download"></i> Baixar Modelo de Apresentação
                        </a>
                        <a href="https://download1523.mediafire.com/gn6p1x26jjbgya5VWUvTLPD3Jn5plB4DLv9pFhaf13TIG8YsmjkSHBURJ2Hkalz6r6rQCBFRKe6EBnwnYBnVRxsfWyM20AmyXo2PkNPPyJoB3uezfOGMsNOF0pqOcYvJxr9CdumnYeJnQdecsEFGswxk42R5e2QH3506gzDYXYYPYdI/ni6lv4feuh068tk/Modelo+de+Banner+III+COAMA.pptx" download class="button">
                            <i class="fas fa-download"></i> Baixar Modelo de Banner
                        </a>
                        <a href="https://download854.mediafire.com/j4j9ysx9udegHXMO-UPQOCGDKzRX57bg3eI1gZ9vGmCPrUwp526Wn6HxYsLcmgBHG7cD1c7YaFoWnKRFzSP7BtI6qx_qO5oOr9bjPAprIlE9IGqY0ACclDiniGe_FMNI32p7HsNOZgiQrNvfHnqZdaDLI3-pxVxx80rvXgojJtXgnl8/o88kny95cara0lh/Modelo_de_artigo_Coama.docx" download class="button">
                            <i class="fas fa-download"></i> Baixar Modelo de Artigo
                        </a>
                    

                        <form action="{% url 'send-work' %}" method="POST" enctype="multipart/form-data">
                            {% csrf_token %}
                            <p>Selecione o arquivo que deseja enviar para avaliação:</p>
                            <label class="label-input" for="comprovante-vinculo">
                                <i class="fas fa-file-alt icon-modify"></i>
                                {{ form.file }}
                            </label>
                        
                            <button id="submitBtnMobile" class="button">Enviar</button>
                        </form>
                    </div>
                    <div class="combo" style="display: none;">
                        <form id="cpf-form" action="{% url 'check-cpf' %}" method="post" class="combo-form">
                            {% csrf_token %}
                            
                            <div class="box">
                                <label for="nome1">Nome 1:</label>
                                <input type="text" id="nome1" name="nome1" required>
                                <br><br>
                                <label for="cpf1">CPF 1:</label>
                                <input type="text" id="cpf1" name="cpf1" oninput="formatCPF(this)" required>
                            </div>
                    
                            <div class="box">
                                <label for="nome2">Nome 2:</label>
                                <input type="text" id="nome2" name="nome2" required>
                                <br><br>
                                <label for="cpf2">CPF 2:</label>
                                <input type="text" id="cpf2" name="cpf2" oninput="formatCPF(this)" required>
                            </div>
                    
                            <div class="box">
                                <label for="nome3">Nome 3:</label>
                                <input type="text" id="nome3" name="nome3" required>
                                <br><br>
                                <label for="cpf3">CPF 3:</label>
                                <input type="text" id="cpf3" name="cpf3" oninput="formatCPF(this)" required>
                            </div>
                    
                            <div class="box">
                                <label for="nome4">Nome 4:</label>
                                <input type="text" id="nome4" name="nome4" required>
                                <br><br>
                                <label for="cpf4">CPF 4:</label>
                                <input type="text" id="cpf4" name="cpf4" oninput="formatCPF(this)" required>
                            </div>
                            
                            <input type="hidden" id="comboValue" name="combo" value="false">
                    
                            <div class="selection-courses-box">
                                <button 
                                    id="confirm-selection" 
                                    type="button" 
                                    style="background-color: #FEB609; border: 1px solid #FEB609; transition: background-color .5s; cursor: pointer; border-radius: 15px; text-transform: uppercase; color: black; font-size: 10px; padding: 10px 50px; font-weight: bold; width: 250px; margin: 1rem;"
                                    onclick="return validateForm();"
                                >
                                Realizar pagamento
                                </button>
                            </div>
                        </form>
                    </div>

                    <script>
                        function formatCPF(input) {
                            let value = input.value.replace(/\D/g, ''); // Remove caracteres não numéricos
                            if (value.length <= 11) {
                                value = value.replace(/(\d{3})(\d)/, "$1.$2");
                                value = value.replace(/(\d{3})(\d)/, "$1.$2");
                                value = value.replace(/(\d{3})(\d{1,2})$/, "$1-$2");
                            }
                            input.value = value;
                        }
                    </script>

    </main>
    <footer>
        
        <div class="tj">
            <span>2024 © COAMA - Congresso Amazônico de Mineração, Metalurgia e Materiais. Desenvolvido por: BITS
                Jr.</span>
            <img src='{% static "src/bits-logo.png" %}' alt="Icone BITS JR. do Curso de Engenharia da Computação">
        </div>
        <div class="tj-media-query">
            <span>2024 © COAMA - Desenvolvido por: BITS
                Jr.</span>
            <img src='{% static "src/bits-logo.png" %}' alt="Icone BITS JR. do Curso de Engenharia da Computação">
        </div>
    </footer>

    <div class="dialog-container">
        <div class="dialog">
            <h2>Atenção</h2>
            <p>Preencha todos os campos obrigatórios.</p>
            <button onclick="fecharDialog()">Fechar</button>
        </div>
    </div>

    <div class="dialog-container" id="dialog-container-course">
        <div class="dialog">
            <h2>Atenção</h2>
            <p>Selecione pelo menos um mini-curso.</p>
            <button onclick="fecharDialogCourse()">Fechar</button>
        </div>
    </div>

    <script src="{% static "js/script.js" %}"></script>
    {% if payed == 'False' %}
    <script>
        const mp = new MercadoPago('APP_USR-52210169-dc3c-4707-9b39-7d935200d689', {locale: 'pt-BR'});
        const bricksBuilder = mp.bricks();
    
        mp.bricks().create("wallet", "wallet_container", {
            initialization: {
                preferenceId: "{{ preferenceId }}",
            },
            customization: {
                texts: {
                    valueProp: 'security_safety',
                },
                checkout: {
                    theme: {
                        elementsColor: "#FEB609",
                        headerColor: "#FEB609",
                    },
                },         
            },
        });
    </script>
    {% endif %}
</body>


</html>
